# server name is same as the service name used in docker-compose file
# port on which the service is running...NOT the exposed port(the RHS port in docker-compose ports attr.)

upstream stockService { server stock:3001; }
upstream stockreceiptService { server stock-receipt:3002; }
upstream movementlogService { server movement-log:3003; }
upstream stockreturnService { server stock-return:3004; }
upstream stockplacesaleorderService { server stock-place-sale-order:3005; }
upstream stocksaleService { server stock-sale:3006; }
upstream taginvdetailService { server taginvdetail:3007; }
upstream masterdataService { server master-data:3008; }
upstream invtracetrackService { server invtracetrack:3009; }
upstream stockblocksaleService { server stock-block-sale:3010; }
upstream stocktransferService { server stock-transfer:3011; }
upstream billingService { server billing:3012; }
upstream dashboardService { server dashboard:3013; }
upstream blockorderService {server block-order:3014;}
upstream markfortestingService {server mark-for-testing:3015;}


server {
    listen 80;

    # location / {
    #     rewrite ^/(/.*)?$ /$1 break; # works for both /server1 and /server1/
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme; 
    #     proxy_pass http://frontendService/;
    # }

    
    location /invtracetrack {
        rewrite ^/invtracetrack(/.*)?$ /invtracetrack$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://invtracetrackService/;
    }

    location /master-data {
        rewrite ^/master-data(/.*)?$ /master-data$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://masterdataService/;
    }

    location /movement-log {
        rewrite ^/movement-log(/.*)?$ /movement-log$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://movementlogService/;
    }

    location /stock {
        rewrite ^/stock(/.*)?$ /stock$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://stockService/;
    }

    location /block-sale {
        rewrite ^/block-sale(/.*)?$ /stock-block-sale$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://stockblocksaleService/;
    }

    location /stock-receipt {
        rewrite ^/stock-receipt(/.*)?$ /stock-receipt$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://stockreceiptService/;
    }

    location /stock-return {
        rewrite ^/stock-return(/.*)?$ /stock-return$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://stockreturnService/;
    }
    location /stock-sale {
        rewrite ^/stock-sale(/.*)?$ /stock-sale$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://stocksaleService/;
    }

    location /stock-transfer {
        rewrite ^/stock-transfer(/.*)?$ /stock-transfer$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://stocktransferService/;
    }

    location /stock-place-sale-order {
        rewrite ^/stock-place-sale-order(/.*)?$ /stock-place-sale-order$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://stockplacesaleorderService/;
    }

    location /taginvdetail {
        rewrite ^/taginvdetail(/.*)?$ /taginvdetail$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://taginvdetailService/;
    }
    location /billing {
        rewrite ^/billing(/.*)?$ /billing$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://billingService/;
    }

    location /dashboard {
        rewrite ^/dashboard(/.*)?$ /dashboard$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://dashboardService/;
    }


    location /block-order {
        rewrite ^/block-order(/.*)?$ /block-order$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://blockorderService/;
    }


     location /mark-for-testing {
        rewrite ^/mark-for-testing(/.*)?$ /mark-for-testing$1 break; # works for both /server1 and /server1/
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_pass http://markfortestingService/;
    }
    
} 